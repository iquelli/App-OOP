classDiagram

    Terminal --> "1" Client : _client
    Client *-- "*" Terminal : _terminals
    Terminal --> "1" TerminalType : _type
    Terminal --> "1" TerminalState : _state
    Communication --> "2" Terminal : _terminalFrom, _terminalTo
    Communication --> "1" CommunicationStatus : _status
    Client --> "1" Tariff : _tariff
    Terminal *-- "*" Communication : _communications
    Network *-- "*" Client : _clients
    Network *-- "*" Terminal : _terminals
    Network *-- "*" Communication : _communications

    class Client{
        %% tag final aqui
        -serialVersionUID long $
        -_key : String
        -_name : String
        -_nif : int
        -_tariff : Tariff
        -_terminals : List~Terminal~
        -_payments : int
        -_debts : int
        -_canReceiveFailedCommunications : boolean

        +getBalance() int
        +addTerminal(terminal : Terminal) void
        +debtPaid(payment : int) void
        +addDebt(debt : int) void
        +enableFailedCommunicationsNotifications() void
        +disableFailedCommunicationsNotifications() void
    }

    class Tariff{
        -_plan : TariffPlan
        #setPlan(plan : TariffPlan) void
        +changePlan(clientBalance : double) void
	    +increaseTextCommunicationsCount() void
        +increateVideoCommunicationsCount() void
	    +resetCommunicationsCount() void
    }

    Tariff "1" <--> "1" TariffPlan : _plan / _tariff

    class TariffPlan{
        #_tariff : Tariff
        #_textCommunications : int
        #_videoCommunications : int
        
        +increaseTextCommunicationsCount() void
        +increateVideoCommunicationsCount() void
        +resetCommunicationsCount() void
        
        +getTextCommunicationCost(charactersNumber : int)* int
        +getInteractiveCommunicationCost(type : CommunicationType)* int
        
        +changePlan(clientBalance : double)* void
    }

    <<abstract>> TariffPlan

    TariffPlan <|-- NormalPlan
    TariffPlan <|--  GoldPlan
    TariffPlan <|--  PlatiniumPlan

    class NormalPlan{
        +getTextCommunicationCost(charactersNumber : int) int
        +getInteractiveCommunicationCost(type : CommunicationType) int
        +changePlan(clientBalance : double) void
    }

    class GoldPlan{
        +getTextCommunicationCost(charactersNumber : int) int
        +getInteractiveCommunicationCost(type : CommunicationType) int
        +changePlan(clientBalance : double) void
    }

    class PlatiniumPlan{
        +getTextCommunicationCost(charactersNumber : int) int
        +getInteractiveCommunicationCost(type : CommunicationType) int
        +changePlan(clientBalance : double) void
    }

    class Communication{
        %% tag final aqui
        -serialVersionUID long $
        -_key : int;
        -_terminalFrom : Terminal
        -_terminalTo : Terminal
        -_status : CommunicationStatus
        -_cost : int

        +setCost(tariff : Tariff)* void
    }

    <<abstract>> Communication
    Communication <|-- InteractiveCommunication
    Communication <|-- TextCommunication

    class TextCommunication{
        -_messageSent : String

        +setCost(tariff : Tariff) void
    }

    class InteractiveCommunication{
        -_duration : int
        -_isVideoCommunication : boolean

        +setCost(tarif : Tariff) void
    }

    class CommunicationStatus{
        ONGOING
        ENDED
    }

    <<enumeration>> CommunicationStatus

    class Terminal{
        %% tag final aqui
        -serialVersionUID long $
        -_key : String
        -_client : Client
        -_type : TerminalType
        -_status : TerminalStatus
        -_communications : List~Communication~
        -_payments : int
        -_debts : int
        -_friends : List~Terminal~
        -_notificationsToBeDelivered : List~Notification~
        -_communication : InteractiveCommunication

        +canEndCurrentCommunication() boolean
        +canStartCommunication() boolean

        +addFriend(friend : Terminal) void
        +endInteractiveCommunication(duration : int) void
        +performPayment(communicationKey : int) void
        +removeFriend(terminalKey : String) void
        +sendTextCommunication(terminalToKey : String, message : String) void
        +showOngoingCommunication() String
        +showTerminalBalance() String
        +silenceTerminal() void
        +startInteractiveCommunication(terminalToKey : String, communicationType : String) void
        +turnoOffTerminal() void
        +turnOnTerminal() void
    }

    class TerminalState{
        #_terminal : Terminal
	
	    +canSendTextCommunication()* boolean
	    +canReceiveTextCommunication()* boolean
	    +canStartInteractiveCommunication()* boolean
	    +canReceiveInteractiveCommunication()* boolean
	
	    +becomeIdle()* void
	    +becomeSilent()* void
	    +becomeBusy()* void
	    +turnOff()* void
    }

    <<abstract>> TerminalState

    TerminalState <|-- Idle
    TerminalState <|-- Silent
    TerminalState <|-- Busy
    TerminalState <|-- Off

    class Idle{
	    +canSendTextCommunication() boolean
	    +canReceiveTextCommunication() boolean
	    +canStartInteractiveCommunication() boolean
	    +canReceiveInteractiveCommunication() boolean
	
	    +becomeIdle() void
	    +becomeSilent() void
	    +becomeBusy() void
	    +turnOff() void
    }

    class Silent{
	    +canSendTextCommunication() boolean
	    +canReceiveTextCommunication() boolean
	    +canStartInteractiveCommunication() boolean
	    +canReceiveInteractiveCommunication() boolean
	
	    +becomeIdle() void
	    +becomeSilent() void
	    +becomeBusy() void
	    +turnOff() void
    }

    class Busy{
	    +canSendTextCommunication() boolean
	    +canReceiveTextCommunication() boolean
	    +canStartInteractiveCommunication() boolean
	    +canReceiveInteractiveCommunication() boolean
	
	    +becomeIdle() void
	    +becomeSilent() void
	    +becomeBusy() void
	    +turnOff() void
    }

    class Off{
	    +canSendTextCommunication() boolean
	    +canReceiveTextCommunication() boolean
	    +canStartInteractiveCommunication() boolean
	    +canReceiveInteractiveCommunication() boolean
	
	    +becomeIdle() void
	    +becomeSilent() void
	    +becomeBusy() void
	    +turnOff() void
    }

    class TerminalType{
        BASIC
        FANCY
    }

    <<enumeration>> TerminalType

    class Notification{
        %% tag final aqui
        -serialVersionUID long $
        -_meanOfDelivery : MeanOfDelivery
        -_terminalFrom : Terminal
        -_type : NotificationType

    }

    Notification --> "1" MeanOfDelivery : _meanOfDelivery
    Notification --> "1" NotificationType : _type
    Notification --> "1" Terminal : _terminalFrom

    class MeanOfDelivery{
        SMS
        EMAIL
        POST_CARD
        APP_REGISTER
    }

    <<enumeration>> MeanOfDelivery

    class NotificationType{
        O2S
        O2I
        S2I
        B2I
    }

    <<enumeration>> NotificationType

    class Network{
        %% tag final aqui
        -serialVersionUID long $
        -_clients : List~Client~
        -_terminals : List~Terminal~
        -_communication : List~Communication~

        -importFile(name : String) void
        +disableClientNotifcations(key : String) void
        +enableClientNotifications(key : String) void
        +registerClient(key : String) void
        +showAllClients() String
        +showClient(key : String) String
        +showClientPaymentsAndDebts(key : String) String

        +showAllCommunications() String
        +showClientsWithDebts() String
        +showClientsWithoutDebts() String
        +showCommunicationsFromClient(key : String) String
        +showCommunicationToClient(key : String) String
        +showTerminalsWithPositiveBalance() String
        +showUnusedTerminals() String

        +showGlobalBalance() String

        +openMenuTerminalConsole(terminalKey : String) void
        +registerTerminal(terminalKey : String, terminalType : String, clientKey : String) void
        +showAllTerminals() String
    }

    class NetworkManager{
        -_network : Network
        +load(filename : String) void
        +save() void
        +saveAs(filename : String) void
        +importFile(filename : String) void

        +openFile(fileName : String) void
        +saveFile(fileName : String) void
    }

    NetworkManager --> "1" Network : _network

    class Serializable
    <<interface>> Serializable
    Network ..|> Serializable
    Communication ..|> Serializable
    Terminal ..|> Serializable
    Client ..|> Serializable
    Notification ..|> Serializable
